<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Editar — SGF</title>
  <link rel="stylesheet" href="assets/css/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <div class="container">
    <header class="header">
      <img src="assets/img/logosovel1337.png" class="logo" alt="logo" />
      <div>
        <div class="title">Editar Ferramental</div>
        <div class="subtitle">Atualize os dados do registro</div>
      </div>
    </header>

    <main class="card fade-in">
      <form id="formEdit" class="form-grid" onsubmit="return false;">
        <select id="tipo" class="select"><option value="">Tipo de Ferramental</option><option>Faca</option><option>Clichê</option><option>Outro</option></select>
        <input id="nfe" class="input" placeholder="Nº da NF-e (opcional)" />
        <input id="sv" class="input" placeholder="SV (código)" />
        <input id="nome" class="input" placeholder="Nome do Ferramental" />
        <input id="dataRegistro" class="input" placeholder="Data de Registro" />
        <input id="estado" class="input" placeholder="Estado" />
        <input id="localizacao" class="input" placeholder="Localização" />
        <div style="display:flex; gap:10px;">
          <button id="btnSalvar" class="btn" type="button">Salvar</button>
          <button class="btn ghost" type="button" onclick="location.href='consultar.html'">Cancelar</button>
        </div>
      </form>
    </main>
  </div>

  <script type="module">
    import { buscarPorId, atualizarFerramental } from './assets/js/script.js';

    function qp(n){ return new URLSearchParams(window.location.search).get(n); }
    const id = qp('id');
    if(!id) { alert('ID inválido'); location.href='consultar.html'; }

    const fields = ['tipo','nfe','sv','nome','dataRegistro','estado','localizacao'];
    async function carregar(){
      const d = await buscarPorId(id);
      if(!d){ alert('Registro não encontrado'); location.href='consultar.html'; return; }
      fields.forEach(f => { const el = document.getElementById(f); if(el) el.value = d[f] || ''; });
    }
    carregar();

    document.getElementById('btnSalvar').onclick = async () => {
      const payload = {};
      fields.forEach(f => payload[f] = document.getElementById(f).value.trim());
      const ok = await atualizarFerramental(id, payload);
      if(ok) setTimeout(()=> location.href='consultar.html',800);
    };
  </script>
</body>
</html>
